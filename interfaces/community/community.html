<!DOCTYPE html>
<html lang="en">

<head>
    <title>Community</title>

    <!-- import custom css -->
    <link rel="stylesheet" href="../../styles/main.css" type="text/css">
    <link rel="stylesheet" href="../../styles/header.css" type="text/css">
    <link rel="stylesheet" href="../../styles/footer.css" type="text/css">
    <link rel="stylesheet" href="../../styles/community.css" type="text/css">

    <script>
        function formatText(command) {
            document.execCommand(command, false, null);
        }

        function importPicture() {
            var input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = handleFileSelect;
            input.click();
        }

        function handleFileSelect(event) {
            var file = event.target.files[0];
            var allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
            if (allowedTypes.indexOf(file.type) === -1) {
                alert('Invalid file type. Please select an image file.');
                return;
            }

            var reader = new FileReader();
            reader.onload = function (event) {
                var img = document.createElement('img');
                img.src = event.target.result;
                img.classList.add('preview-image');
                document.getElementById('imagePreview').appendChild(img);
            };
            reader.readAsDataURL(file);
        }

        function postContent() {
            var content = document.getElementById('myTextArea').innerHTML;
            var postedContent = document.createElement('div');
            postedContent.innerHTML = content;
            postedContent.classList.add('post-content');

            var images = document.getElementById('imagePreview').getElementsByTagName('img');
            for (var i = 0; i < images.length; i++) {
                var img = document.createElement('img');
                img.src = images[i].src;
                img.classList.add('preview-image');
                postedContent.appendChild(img);
            }

            var postActions = document.createElement('div');
            postActions.innerHTML = `
                <button class="like-button" onclick="likePost(this)"><img src="../../assets/like.svg" alt="like" height="27px" width="27px"></button>
                <button class="comment-button" onclick="commentPost(this)"><img src="../../assets/comment.svg" alt="bold" height="24px" width="24px"></button>
            `;
            postedContent.appendChild(postActions);

            var likesContainer = document.createElement('div');
            likesContainer.classList.add('likes-container');
            postedContent.appendChild(likesContainer);

            document.getElementById('postedContentContainer').appendChild(postedContent);
            document.getElementById('myTextArea').innerHTML = ''; // Clear the text area
            document.getElementById('imagePreview').innerHTML = ''; // Clear the image preview
        }

        function likePost(button) {
            var postElement = button.parentNode.parentNode;
            var likesContainer = postElement.querySelector('.likes-container');
            var likeCount = likesContainer.querySelector('.like-count');
            var likeButton = button.querySelector('img');

            if (!likeCount) {
                likeCount = document.createElement('span');
                likeCount.classList.add('like-count');
                likeCount.textContent = 'Likes: 1';
                likesContainer.appendChild(likeCount);

                likeButton.src = "../../assets/liked.svg"; // Change the like button image to "liked"
                likeButton.alt = "liked";
            } else {
                var currentLikes = parseInt(likeCount.textContent.split(':')[1].trim());
                if (likeButton.alt === "liked") {
                    likeCount.textContent = 'Likes: ' + (currentLikes - 1);
                    likeButton.src = "../../assets/like.svg"; // Change the like button image back to "like"
                    likeButton.alt = "like";
                } else {
                    likeCount.textContent = 'Likes: ' + (currentLikes + 1);
                    likeButton.src = "../../assets/liked.svg"; // Change the like button image to "liked"
                    likeButton.alt = "liked";
                }
            }

            button.disabled = true; // Disable the like button to prevent multiple clicks
        }

        function commentPost(button) {
            var postElement = button.parentNode.parentNode;
            var commentContainer = postElement.querySelector('.comment-container');

            if (commentContainer) {
                commentContainer.remove(); // Remove the comment input container if it already exists
            } else {
                commentContainer = document.createElement('div');
                commentContainer.classList.add('comment-container');

                var commentInput = document.createElement('input');
                commentInput.type = 'text';
                commentInput.placeholder = 'Enter your comment...';
                commentInput.classList.add('comment-input');

                var commentButton = document.createElement('button');
                commentButton.textContent = 'Submit';
                commentButton.classList.add('submit-comment-button');
                commentButton.onclick = function () {
                    submitComment(postElement, commentInput);
                };

                commentContainer.appendChild(commentInput);
                commentContainer.appendChild(commentButton);

                postElement.appendChild(commentContainer); // Add the comment input container
            }
        }

        function submitComment(postElement, commentInput) {
            var commentText = commentInput.value;
            if (commentText.trim() === '') {
                alert('Please enter a comment.');
                return;
            }

            var comment = document.createElement('div');
            comment.classList.add('comment');
            comment.textContent = commentText;

            var commentContainer = postElement.querySelector('.comment-container');
            commentContainer.parentNode.insertBefore(comment, commentContainer);

            commentInput.value = ''; // Clear the comment input
            commentContainer.remove(); // Remove the comment input container
        }
    </script>
</head>

<body>

    <!-- community -->
    <div class="community">

        <!-- breadcrumb -->
        <div class="breadcrumb">
            <a href="#">Community</a>
        </div>

        <!-- title-->
        <h1>Community</h1>

        <div class="content">

            <!-- writing area -->
            <div class="writing-area">
                <h3>Share something to your feed</h3>
                <div class="text-area" id="myTextArea" contenteditable="true"></div>
                <div id="imagePreview"></div>

                <div class="action-icon-content">
                    <div class="action-icon-container">
                        <button class="action-icon" onclick="formatText('bold')"><img src="../../assets/bold-icon.svg"
                                alt="bold" height="14px" width="15px"></button>
                        <button class="action-icon" onclick="formatText('underline')"><img
                                src="../../assets/underline-icon.svg" alt="underline" height="14px"
                                width="15px"></button>
                        <button class="action-icon" onclick="formatText('italic')"><img
                                src="../../assets/italic-icon.svg" alt="italic" height="17px" width="17px"></button>
                        <span class="vertical-divider"></span>
                        <button class="action-icon" onclick="importPicture()"><img src="../../assets/photo-icon.svg"
                                alt="picture" height="17px" width="17px"></button>
                    </div>

                    <button onclick="postContent()">Post</button>
                </div>
            </div>
        </div>

        <hr style=" margin-left: 10px; margin-top: 30px; margin-bottom: 30px; width: 1280px;">

        <!-- posting area -->
        <div>
            <div class="posted-content" id="postedContentContainer"></div>
        </div>
    </div>

</body>

</html>